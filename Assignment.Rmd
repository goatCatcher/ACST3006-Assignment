---
title: "ACST3006 Assignment"
author: "Toby Burgess"
date: '2023-03-23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

## Introduction
### Question 1

In this question, we aim to analyze the optimal risky portfolio for two risky assets and study the relationship between the assets' correlation and the resulting possible portfolios. We will be using R to perform the calculations and visualize the results.

Firstly, using our portfolio means and sd, we can populate the table given using results given in the lectures.
```{r results='asis', echo=FALSE}
library(knitr)
library(kableExtra)
source("~/Uni/ACST3006/Assignment/Scripts/Q1.R", echo=FALSE)

formatted_table <- portfolio_stats_df %>%
  kable(format = "html", digits = 4, col.names = c("Weight Asset 1", "Weight Asset 2", "Portfolio Return", "Portfolio SD")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F) %>%
  column_spec(1, bold = F, border_right = T) %>%
  column_spec(2, bold = F, border_right = T) %>%
  column_spec(3, bold = F, border_right = T) %>%
  column_spec(4, bold = F)

print(formatted_table)
```
Now to find the optimal risky portfolio, 

\begin{equation}
E(\mathbf{R}) = \begin{bmatrix}
0.0015\\
0.008
\end{bmatrix}
\end{equation}

And:
\begin{align}
\text{Cov}(R_1, R_2) &= 0.4 \times 0.1 \times 0.05 \\
                     &= 0.002
\end{align}

We calculate the covariance matrix as:
\begin{equation}
V = \begin{bmatrix}
0.01 & 0.02 \\
0.02 & 0.025
\end{bmatrix}
\end{equation}

We get the inverse matrix as:

\begin{equation}
V^{-1} = \begin{bmatrix}
119.0476 & -95.2381 \\
-95.2381 & 476.1905
\end{bmatrix}
\end{equation}

So, we can find:

\begin{align}
A &= \begin{bmatrix}
0.0015\\
0.008
\end{bmatrix}'\begin{bmatrix}
119.0476 & -95.2381 \\
-95.2381 & 476.1905
\end{bmatrix}^{-1}\begin{bmatrix}
0.0015\\
0.008
\end{bmatrix} \\
&= 0.03440476 \\
B &= \begin{bmatrix}
0.0015\\
0.008
\end{bmatrix}'\begin{bmatrix}
119.0476 & -95.2381 \\
-95.2381 & 476.1905
\end{bmatrix}^{-1}\begin{bmatrix}
1\\
1
\end{bmatrix} \\
&= 3.404762 \\
C &= \begin{bmatrix}
1\\
1
\end{bmatrix}'\begin{bmatrix}
119.0476 & -95.2381 \\
-95.2381 & 476.1905
\end{bmatrix}^{-1}\begin{bmatrix}
1\\
1
\end{bmatrix}\\
&= 404.7619 \\
D &= \det\begin{bmatrix}
A & B \\
B & C
\end{bmatrix}
= AC - B^2 \\
&=2.333333
\end{align}

The optimal return can be then found with:

\begin{align}
E(R_c) &= \frac{B\,E(R_{p^*})-A}{C\,E(R_{p^*})-B}\\
E(R_{p^*}) &= \frac{B*0.004-A}{C*0.004-B} \\
&= 1.164\%
\end{align}

And the standard deviation:

\begin{align}
\sigma_{R_p^*} &= (\frac{C\,\{E(R_p^*)\}^2-2\,B\,E(R_p^*) +A}{D})^{\frac{1}{2}}\\
&=(\frac{C\,\{0.01164\}^2-2\,B\,\times0.01164 +A}{D})^{\frac{1}{2}} \\
&= 0.06540948
\end{align}


Now we find the capital allocation line:

\begin{align}
E(R_p) &= E(R_p^Z) +\frac{D\,\sigma_{R_{p^*}}}{C\,E(R_{p^*})-B}\times\sigma_{R_{p}} \\
E(R_p) &= 0.004 + 0.1168026\times\sigma_{R_{p}}
\end{align}

Plotting this, we get:

```{r, echo=FALSE}
q1plot1
```

We can also graph the set of possible portfolios when correlation is as follows:
```{r, echo=FALSE}
q1plot2
```

### Question 2

We are given the monthly return for stocks, U.S. portfolios and country portfolios.

#### Part I
Let us calculate the mean return, standard deviation, correlations and variances/covariances on all available stocks / portfolios

```{r, echo=TRUE}
stock_returns <- fread("Data/Q2.csv")

# Manipulate Data ---------------------------------------------------------
# Store the investment categories and investment types
investment_categories <- as.character(unlist(stock_returns[1, ]))[-1]
investment_types <- as.character(unlist(stock_returns[2, ]))[-1]
stock_returns <- stock_returns[-c(1, 2)]
colnames(stock_returns) <- c("Date", as.vector(investment_types))

# Convert the data.table to long format using melt()
stock_returns_melt <- melt(stock_returns, id.vars = "Date", variable.name = "Investment", value.name = "Return")
stock_returns_melt[, Investment_Category := investment_categories[Investment], by = Investment]
stock_returns_melt <- stock_returns_melt[, .(Investment, Investment_Category, Date, Return)][, Return := as.numeric(Return)]

# Part I ------------------------------------------------------------------
# Calculate mean return
mean_returns <- stock_returns_melt[, .(Mean_Return = mean(Return)), by = .(Investment, Investment_Category)]
sd_returns <- stock_returns_melt[, .(SD_Return = sd(Return)), by = .(Investment, Investment_Category)]
risk_free_rate <- mean_returns[Investment == "US Riskfree", Mean_Return]

# Calculate the covariances and correlations among risky assets
risky_assets <- stock_returns_melt[Investment != "US Riskfree"]
risky_assets_wide <- dcast(risky_assets, Date ~ Investment, value.var = "Return")

# Remove the 'Date' column
risky_assets_wide[, Date:=NULL]

# Compute the covariance matrix
cov_matrix <- cov(risky_assets_wide)

# Compute the correlation matrix
cor_matrix <- cor(risky_assets_wide)

print(mean_returns)
print(sd_returns)
print(risk_free_rate)
print(cov_matrix)
print(cor_matrix)


```



